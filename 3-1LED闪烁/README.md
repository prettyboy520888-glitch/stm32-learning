# STM32 学习笔记：标准外设库与 Keil 工程配置指南

本仓库/文档记录了在学习 STM32 单片机（基于标准外设库 Standard Peripheral Library）过程中的核心知识点，特别是关于 GPIO 底层控制函数以及 Keil MDK 工程的标准化配置流程。

---

## 目录 (Table of Contents)
1. [STM32 GPIO 核心输出函数速查](#1-stm32-gpio-核心输出函数速查)
2. [Keil 工程核心配置逻辑 (两步走)](#2-keil-工程核心配置逻辑-两步走)
3. [常见工程报错与排查指南](#3-常见工程报错与排查指南)

---

## 1. STM32 GPIO 核心输出函数速查

在 `stm32f10x_gpio.c` 中，最常用的四个管脚电平控制函数对比如下：

| 函数原型 | 功能描述 | 底层寄存器 | 适用场景 |
| :--- | :--- | :--- | :--- |
| `GPIO_SetBits(GPIOx, GPIO_Pin)` | 强制拉高引脚电平 (逻辑 1) | BSRR | 确定要拉高某个/某些信号时。原子操作，安全高效。 |
| `GPIO_ResetBits(GPIOx, GPIO_Pin)` | 强制拉低引脚电平 (逻辑 0) | BRR / BSRR | 确定要拉低某个/某些信号时。原子操作，安全高效。 |
| `GPIO_WriteBit(GPIOx, GPIO_Pin, BitVal)` | 根据传入变量动态设置高/低电平 | BSRR / BRR | 输出状态由代码逻辑变量动态决定时，免去 `if-else` 判断。 |
| `GPIO_Write(GPIOx, PortVal)` | 同时对整个 GPIO 端口(16位)写入数据 | ODR | 并行总线通信（如驱动 LCD 屏幕、数码管等多引脚同步控制）。 |

> **💡 提示**：操作 GPIO 之前，请务必先开启对应的 APB2 外设时钟，并完成 `GPIO_Init` 模式配置。

---

## 2. Keil 工程核心配置逻辑 (两步走)

搭建 STM32 标准库工程时，核心思想是将物理文件合理编排进编译器的工作流中，必须严格区分 `.c` 源文件和 `.h` 头文件的不同管理机制。

### 第一步：招募工人 (Manage Project Items)
* **操作对象**：`.c` (C源文件) 和 `.s` (汇编启动文件，如 `startup_stm32f10x_md.s`)。
* **操作路径**：点击魔术棒旁边的 `Manage Project Items`（品字形图标） -> 在具体的 Group 中 `Add Files`。
* **底层逻辑 (精准点名)**：Keil 编译器只会编译被显式添加到工程分组中的源文件。如果文件在硬盘里但没被 Add 进来，编译器会当它不存在。

### 第二步：分配图纸 (Options for Target)
* **操作对象**：`.h` (头文件) 和 全局编译规则。
* **操作路径**：点击 `Options for Target` (魔术棒图标) -> `C/C++` 选项卡。
* **核心配置 1：Define (全局宏定义)**
  * 填入：`USE_STDPERIPH_DRIVER`
  * 作用：打开标准库的全局总开关，允许工程调用 ST 官方库函数。
* **核心配置 2：Include Paths (头文件路径)**
  * 填入：`.\Start`、`.\Library` 等包含 `.h` 文件的目录。
  * **底层逻辑 (划定片区)**：遇到 `#include` 时，编译器会自动去这些指定的文件夹里寻找对应的 `.h` 图纸。不需要也不应该把 `.h` 文件在第一步中 Add 到左侧工程树里。

---

## 3. 常见工程报错与排查指南

### 🐛 异常现象 1：编辑器顶部出现两个 `main.c` 标签页
* **原因分析**：通常是 IDE 的历史工作区缓存遗留，或通过不同绝对/相对路径打开了同一个文件导致的显示重叠。并非真的有两个文件参与编译（否则链接器会报 `multiply defined` 错误）。
* **解决办法**：鼠标悬停在标签页上查看文件的**绝对路径 (Absolute Path)**。保留当前工程路径下的那个，直接关闭另一个即可。

### 🐛 异常现象 2：不小心打开了 `stm32f10x_gpio.h` 等底层文件
* **原因分析**：通常是按了 `F12` 或右键执行了 `Go To Definition` (跳转到定义) 触发的。
* **解决办法**：这些是 ST 官方提供的基础设施文件，包含宏定义和防卫式声明。**原则是“只读不改”**，直接点击右上角 `×` 关闭即可，不要随意修改里面的代码。

---
*Documented during STM32 learning journey.*