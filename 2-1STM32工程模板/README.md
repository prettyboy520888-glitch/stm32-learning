# STM32 学习笔记：GPIO 与底层硬件逻辑

本仓库记录了基于标准外设库 (Standard Peripheral Library, SPL) 学习 STM32 微控制器的核心基础知识，重点剖析 GPIO 的底层硬件结构与配置逻辑。

---

## 1. 从 8 位到 32 位微控制器的底层跨越

在学习 STM32 之前，必须理解 32 位系统与经典 8 位单片机（如 51 系列）的本质区别：

* **处理能力 (算术逻辑单元与数据总线)：** 8 位系统单次只能处理 8 个二进制位（最大值 255）；32 位系统单次能吞吐 32 个二进制位（最大值约 42.9 亿），运算带宽和速度呈指数级跃升。
* **寻址空间 (内存与外设容量)：** 8 位系统的地址总线通常只能访问 64KB 空间；32 位系统可直接访问高达 4GB 的内存地址，这使得 STM32 内部能够集成极多、极其复杂的硬件外设（如高级定时器、多路 ADC、丰富的通信接口）。

## 2. STM32 标准库编程的“四大通用步骤”

为了管理复杂的 32 位寄存器，STM32 采用高度模块化的结构体编程范式。无论配置 GPIO 还是高级外设，均遵循以下四步曲：

1. **开启时钟 (Enabling the Clock)：** 给对应的硬件模块（如 GPIOA）通电。如果不开启时钟，所有的配置指令都无法写入硬件。
2. **定义配置结构体 (Defining the Struct)：** 在内存中声明一个配置单（如 `GPIO_InitTypeDef`），用于打包管理该外设的所有参数。
3. **填写配置参数 (Configuring Properties)：** 逐项设定引脚号、运行速度和工作模式。
4. **提交初始化 (Applying and Executing)：** 调用专用的 `Init` 库函数，将填好的配置单翻译为底层二进制码，正式写入硬件控制寄存器。

> **核心概念支撑：**
> * **结构体 (Structs)：** 将相关的多个变量打包在一起，避免传参混乱。
> * **库函数 (Library Functions)：** 官方编写的硬件抽象层 (HAL/SPL)，代替开发者执行复杂且极易出错的寄存器绝对地址读写操作。

## 3. GPIO 的 8 种工作模式

GPIO (General-Purpose Input/Output) 是微控制器与外部世界交互的桥梁。STM32 提供了 8 种精细的工作模式：

### 输入模式 (Input Modes - 读取外部电信号)
* **浮空输入 (`GPIO_Mode_IN_FLOATING`)：** 内部上下拉电阻断开，电平状态完全由外部电路决定（常用于特定通信协议接收）。
* **上拉输入 (`GPIO_Mode_IPU`)：** 接入内部连接 VDD 的电阻，悬空时默认保持高电平（常用于读取外部机械按键）。
* **下拉输入 (`GPIO_Mode_IPD`)：** 接入内部连接 GND 的电阻，悬空时默认保持低电平。
* **模拟输入 (`GPIO_Mode_AIN`)：** 关闭数字电路（施密特触发器），将纯净的连续模拟电压信号送入内部模数转换器 (ADC)。

### 输出模式 (Output Modes - 发送外部电信号)
* **推挽输出 (`GPIO_Mode_Out_PP`)：** 内部 P-MOS 和 N-MOS 均参与工作，能强力输出高电平 (3.3V) 和低电平 (0V)，驱动能力强（常用于点亮 LED 或发送基础数字信号）。
* **开漏输出 (`GPIO_Mode_Out_OD`)：** 切断 P-MOS，只能输出低电平。输出高电平需依赖外部上拉电阻（常用于 I2C 等需要多设备挂载的总线协议）。
* **复用推挽输出 (`GPIO_Mode_AF_PP`)：** 电路等同推挽，但高低电平的翻转控制权移交给内部硬件外设（例如由硬件定时器自动生成 PWM 波）。
* **复用开漏输出 (`GPIO_Mode_AF_OD`)：** 电路等同开漏，控制权移交给内部硬件外设（例如由硬件 I2C 模块接管）。

## 4. GPIO 内部微观物理结构

理解底层硬件结构，是脱离死记硬背的关键：



* **保护二极管：** 应对瞬间过高或过低的杂波电压，保护脆弱的硅芯片。
* **可控上下拉电阻：** 对应代码中的 IPU/IPD 配置，提供稳定的默认电平。
* **施密特触发器 (Schmitt Trigger)：** 数字输入通道的“整形器”，将波动的模拟电压精确转化为纯粹的逻辑 0 和逻辑 1。
* **输出控制管 (P-MOS & N-MOS)：** 决定推挽或开漏特性的核心功率开关组件。

## 5. 进阶核心：ADC 与复用功能 (Alternate Function)

* **模数转换器 (ADC)：** 芯片的“翻译官”。结合 `GPIO_Mode_AIN`，将连续的真实世界信号（如温度传感器电压）量化为 CPU 可读的离散数字（如 12-bit ADC 将电压划分为 0-4095 个刻度）。
* **复用功能 (AF, Alternate Function)：** 硬件级别的“让权”机制。切断 CPU 对引脚的直接干预，将引脚通道直接连通至内部的高级专用硬件（如定时器、串口）。这使得硬件能以极高的速度自动处理外部信号（如高频脉冲计数、串口数据接收），彻底解放 CPU 算力。